# SambaAd to Bind9
## Overview

This Python script automates the process of generating BIND9 compatible zone files and configurations from DNS records. It begins by executing a DNS dumper script to gather zone information, then parses this information to generate forward and reverse zone files, as well as a main BIND9 configuration file.

## Features

- Executes a DNS dumper script to gather zone information
- Parses DNS record information from input files
- Generates forward zone files for each specified domain
- Creates reverse zone files for IP subnets
- Produces a main BIND9 configuration file
- Outputs JSON files for each parsed zone (useful for debugging or further processing)

## Requirements

- Python 3.6+
- Bash shell
- DNS dumper script (`dns_dumper.sh`)
- No external Python libraries required (uses only Python standard library)

## Usage

1. Ensure the DNS dumper script (`dns_dumper.sh`) is in the same directory as the Python script.

2. Run the Python script:
   ```
   python dns_zone_generator.py
   ```

3. The script will perform the following steps:
   - Execute the DNS dumper script to gather zone information
   - Parse the gathered information
   - Generate forward zone files in the `forward_zone/` directory
   - Create reverse zone files in the `reverse_zone/` directory
   - Output JSON representations of parsed data in the `json/` directory
   - Produce a main BIND9 configuration file named `named.conf.local`

## Configuration

You can modify the following constants at the top of the script to match your setup:

- `ZONE_FILE`: The name of the file containing the list of zones to process (default: "zone.txt")
- `HIGH_LEVEL_DOMAIN`: The top-level domain for your DNS setup (default: "example.com")
- `DOMAIN_NAME`: The internal domain name (default: "internal.example.com")
- `SOA_NS_ENTRY`: The authoritative name server for your zones (default: "mstbind.example.com")
- `SOA_HOSTMASTER_ENTRY`: The email address for the hostmaster (default: "hostmaster.example.com.")
- `HOST_IPV4`: The IPv4 address for the authoritative name server (default: "192.168.0.0.")

## Input File Format

### zone.txt (generated by dns_dumper.sh)
```
example.com
subdomain.example.com
```

### zone_query/example.com.txt (generated by dns_dumper.sh)
```
Name=,Records=5,Children=2
SOA:example.com ttl=86400)
NS:ns1.example.com ttl=86400)
NS:ns2.example.com ttl=86400)
A:192.168.1.1 ttl=3600)
CNAME:www.example.com ttl=3600)
```

## Output

The script generates the following types of files:

1. Forward zone files (e.g., `forward_zone/db.example.com`)
2. Reverse zone files (e.g., `reverse_zone/db.192.168.1.arpa`)
3. JSON files containing parsed data (e.g., `json/example.com.json`)
4. A main BIND9 configuration file (`named.conf.local`)

## Key Functions

- `parse_record()`: Parses a single DNS record line
- `parse_file()`: Parses an entire DNS zone file
- `generate_bind9_zone()`: Generates a BIND9 zone file from parsed data
- `generate_reverse_zone()`: Generates reverse zone entries
- `write_reverse_zone_files()`: Writes reverse zone files
- `generate_bind9_config()`: Generates the main BIND9 configuration file
- `main()`: Orchestrates the entire zone generation process

## DNS Dumper Script

The script begins by executing a DNS dumper script (`dns_dumper.sh`) using subprocess. This script is expected to gather the necessary DNS zone information and create the required input files (`zone.txt` and files in the `zone_query/` directory). The Python script will exit if the DNS dumper fails to execute successfully.

## Error Handling

The script includes basic error handling for the DNS dumper execution. If the dumper script fails (returns a non-zero exit code), the Python script will terminate with an error message.

## Contributing

Contributions to improve the script are welcome. Please submit a pull request or open an issue to discuss proposed changes.

## License

This project is open source and available under the [MIT License](LICENSE).